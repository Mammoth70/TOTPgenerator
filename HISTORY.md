## История TOTPgenerator

Нумерация версий использует следующий формат:  

Major.Minor.Patch  

Major - крупные изменения и добавления, а также, изменения, которые делают приложения с разными Major версиями несовместимыми полностью или частично.
Minor - небольшие изменения, влияющие на ход выполнения приложения или на интерфейс.
Patch - совсем незначительные изменения.  

Обычно, нумерация версий идёт по порядку.

### 1.0.0 - 1.0.1
Ранние версии. (Не выкладывались на github).

### 1.1.0
Первая версия, выложенная на github.

Добавлена защита входа PIN-кодом.  
Добавлены настройки: ввод, смена и удаление PIN-кода; направление движения индикатора прогресса.

### 1.1.1
Чтение из потока теперь делается без вызова фунции putData(), код теперь написан в лямбде.  

Обновлены версии библиотек и удалены неиспользуемые в build.gradle.kts.

### 1.1.2
Переименованы переменные и константы, константы перенесены между файлами. Изменено форматирование текста.

### 1.1.3
Удалены лишние переменные. Вместо "(if ... != null)" использованы "...?.let". 

### 1.2.0
Изменения в функции разбора QR. Добавлено декодирование "процентных кодов", а в кодировке base32 разрешены символы нижнего регистра.

### 1.2.1
Метод adapter.notifyDataSetChanged() теперь вызывается при любом перестроении списка токенов.

### 1.2.2
Переименованы переменные.

### 1.3.0
Добавлен вход по биометрии.

### 1.4.0
Кнопка FAB "Добавить" удалена, вместо неё сделана кнопка меню в верхней панели.  

В activity "Настройки" добавлен выбор режима темы "День", "Ночь" и "Системная".  

В activity "Настройки" изменён вид кнопок "Назначить PIN" и "Удалить PIN".  

В списке токенов сделано пустое поле - footer для того, чтобы кнопка FAB не закрывала последнюю запись в списке.  

Не требуется ввод PIN-кода или проверка биометрии про повторном входе, пока приложение остаётся в памяти.  

Небольшой рефакторинг заголовка входа по биометрии.

### 1.4.1
В activity "Настройки" удалена пустая нижняя панель и оптимизирован макет.  

Переименованы константы, константы перенесены между файлами.

### 1.4.2
Индикатор прогресса в режиме "осталось" теперь крутится по часовой стрелке.

### 1.4.3
Смена версии Gradle на 9.0.0.  

Переход на встроенный Kotlin.

### 1.4.4
Изменение года разработки приложения в ресурсах strings.xml.

### 1.4.5
В классе TokensAdapter использованы apply{}.

### 1.4.6
Смена версии Gradle на 9.3.0.  

Переход на AGP 9.0.0.  

Объявления зависимостей перенесены в libs.versions.toml.  

Удалены deprecated настройки в gradle.properties.  

Выполнено уменьшение размера apk. Включены соответствующие настройки в app/build.gradle.kts. Добавлен файл res/raw/keep.xml.  

Отказ от конструкции "object : PopupMenu.OnMenuItemClickListener" при создании меню.  

Отказ от использования android:onClick в макетах. Вместо этого сделаны программные установки листенера через setOnClickListener.  

Переписана функция копирования токена в буфер обмена. Учтены особенности разных версий. Добавлено сокрытие чувствительных данных.

Добавлена очистка буфера обмена через 30 секунд.

### 1.4.7
В задержке очистки буфера обмена теперь используется lifecycleScope.launch вместо Handler.  

Запрещено создание скриншотов экрана ввода PIN-кода, экрана со списком токенов и карточки токена.

### 1.4.8
Переименование макетов.  
Для переиспользуемых макетов (include) применяется префикс partial_. Для диалога - префикс dialog_.  

Изменения в ресурсах.  
В меню удалены группы. Добавлено меню чтения QR. Изменена прозрачность некоторых иконок.

### 1.5.0
Изменения в вводе, хранении и проверке PIN-кода.  
Использование String заменено на CharArray.  
PIN-код хранится в виде криптографического хеша с использованием уникальной соли. Сам хеш дополнительно шифруется перед сохранением.  
Сразу после вычисления хеша CharArray затирается.  
Проверка выполняется путем сравнения хешей введённого и сохранённого PIN-кодов.

### 1.6.0
Вместо ListView и ArrayAdapter теперь используется RecyclerView и ViewAdapter c Payload.

### 1.7.0
Изменения в TokensViewModel.  
Теперь, токены накапливаются в список, и делается один emit всего списка раз в секунду.  
Больше не используется и удалён глобальный список токенов appTokens.  

Изменения в классах данных секретов и токенов.  
Глобальный список секретов appSecrets перенесён из App в TokensViewModel, и в нём удалено больше неиспользуемое поле num.  
Тип полей id секрета OTPauth и токена Token сменён с Int на Long. (Хотя, вряд ли количество секретов превысит 2147483647).  

Изменения в передаче данных.  
Листенеры из адаптера теперь передают либо уникальный id-токена/секрета, либо строку с цифрами токена.  
Диалоговое окно секретов переделано для работы через id-токена.

### 1.7.1
Изменения в TokensViewModel.  
Массивы байтов секретов подготавливаются из строк base32 заранее перед циклом генерации.  
Вызов генератора токенов обёрнут в блок try catch. В случае ошибки генерации вместо токена выводится "------".  
Если список секретов пустой, то flow не выполняется до следующего sendCommandUpdate().

### 1.8.0
Изменения в классе Token, а также в TokensViewModel, TokensAdapter, настройках и макете.  
Теперь, можно дополнительно включить генерацию следующего за текущим токена.

### 1.8.1
Теперь, при смене флага генерации следующих токенов TokensViewModel не перезапускается.  

Добавлены комментарии.